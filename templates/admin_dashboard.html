<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Super Admin Dashboard - Enterprise Support System</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-color: #dc3545;
            --secondary-color: #6c757d;
            --success-color: #28a745;
            --info-color: #17a2b8;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
            --light-color: #f8f9fa;
            --dark-color: #343a40;
            --sidebar-width: 280px;
            --header-height: 70px;
            --border-radius: 12px;
            --shadow: 0 4px 20px rgba(0,0,0,0.1);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--light-color);
            color: var(--dark-color);
            overflow-x: hidden;
        }

        /* Header */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: var(--header-height);
            background: linear-gradient(135deg, var(--primary-color), #c82333);
            color: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            box-shadow: var(--shadow);
            z-index: 1000;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .header-title {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .header-subtitle {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .logout-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
        }

        .logout-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            top: var(--header-height);
            left: 0;
            width: var(--sidebar-width);
            height: calc(100vh - var(--header-height));
            background: white;
            border-right: 1px solid #e9ecef;
            overflow-y: auto;
            z-index: 999;
            transition: var(--transition);
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid #e9ecef;
            background: var(--light-color);
        }

        .sidebar-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--dark-color);
        }

        .nav-menu {
            padding: 20px 0;
        }

        .nav-item {
            margin-bottom: 5px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 15px 20px;
            color: #666;
            text-decoration: none;
            transition: var(--transition);
            border-left: 3px solid transparent;
        }

        .nav-link:hover,
        .nav-link.active {
            background: var(--light-color);
            color: var(--primary-color);
            border-left-color: var(--primary-color);
        }

        .nav-link i {
            width: 20px;
            text-align: center;
        }

        /* Main Content */
        .main-content {
            margin-left: var(--sidebar-width);
            margin-top: var(--header-height);
            padding: 30px;
            min-height: calc(100vh - var(--header-height));
            transition: var(--transition);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .page-header {
            margin-bottom: 30px;
        }

        .page-title {
            font-size: 2rem;
            font-weight: 700;
            color: var(--dark-color);
            margin-bottom: 10px;
        }

        .page-subtitle {
            color: #666;
            font-size: 1.1rem;
        }

        /* Dashboard Overview */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--shadow);
            border: 1px solid #e9ecef;
            transition: var(--transition);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 30px rgba(0,0,0,0.15);
        }

        .stat-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            color: white;
        }

        .stat-icon.primary { background: var(--primary-color); }
        .stat-icon.success { background: var(--success-color); }
        .stat-icon.info { background: var(--info-color); }
        .stat-icon.warning { background: var(--warning-color); }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--dark-color);
            margin-bottom: 5px;
        }

        .stat-label {
            color: #666;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .stat-change {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9rem;
            margin-top: 10px;
        }

        .stat-change.positive { color: var(--success-color); }
        .stat-change.negative { color: var(--danger-color); }

        /* Charts Section */
        .charts-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 40px;
        }

        /* User Management */
        .user-management {
            background: white;
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--shadow);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e9ecef;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--dark-color);
        }

        .add-user-btn {
            background: var(--success-color);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .add-user-btn:hover {
            background: #218838;
            transform: translateY(-2px);
        }

        .user-form {
            background: var(--light-color);
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 25px;
            display: none;
        }

        .user-form.show {
            display: block;
            animation: slideDown 0.3s ease-out;
        }

        @keyframes slideDown {
            from { opacity: 0; max-height: 0; }
            to { opacity: 1; max-height: 500px; }
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark-color);
        }

        .form-group input,
        .form-group select {
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
            transition: var(--transition);
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(220, 53, 69, 0.1);
        }

        .form-actions {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
        }

        .btn-primary { background: var(--primary-color); color: white; }
        .btn-secondary { background: var(--secondary-color); color: white; }
        .btn-success { background: var(--success-color); color: white; }
        .btn-danger { background: var(--danger-color); color: white; }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        /* Users Table */
        .users-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .users-table th,
        .users-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #e9ecef;
        }

        .users-table th {
            background: var(--light-color);
            font-weight: 600;
            color: var(--dark-color);
            position: sticky;
            top: 0;
        }

        .users-table tr:hover {
            background: var(--light-color);
        }

        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-active {
            background: #d4edda;
            color: #155724;
        }

        .status-inactive {
            background: #f8d7da;
            color: #721c24;
        }

        .role-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .role-admin {
            background: #fff3cd;
            color: #856404;
        }

        .role-agent {
            background: #d1ecf1;
            color: #0c5460;
        }

        /* Performance Reports */
        .performance-section {
            background: white;
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--shadow);
        }

        .report-controls {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .report-controls select {
            padding: 8px 12px;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            font-size: 14px;
            background: white;
        }

        .performance-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .performance-card {
            background: var(--light-color);
            border-radius: 10px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            border: 1px solid #e9ecef;
            transition: var(--transition);
        }

        .performance-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .performance-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
        }

        .performance-content {
            flex: 1;
        }

        .performance-number {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--dark-color);
            margin-bottom: 5px;
        }

        .performance-label {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 8px;
        }

        .performance-trend {
            font-size: 0.8rem;
            font-weight: 600;
        }

        .performance-trend.positive {
            color: var(--success-color);
        }

        .performance-trend.negative {
            color: var(--danger-color);
        }

        .performance-charts {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
        }

        .chart-legend {
            display: flex;
            gap: 20px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            color: #666;
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .legend-color.ai {
            background: var(--primary-color);
        }

        .legend-color.human {
            background: var(--success-color);
        }

        /* System Settings */
        .settings-section {
            background: white;
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--shadow);
        }

        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .settings-card {
            background: var(--light-color);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #e9ecef;
            transition: var(--transition);
        }

        .settings-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .settings-card-header {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e9ecef;
        }

        .settings-card-header h3 {
            color: var(--dark-color);
            font-size: 1.2rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .settings-card-header i {
            color: var(--primary-color);
        }

        .settings-form .form-group {
            margin-bottom: 20px;
        }

        .settings-form .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark-color);
        }

        .settings-form .form-group input,
        .settings-form .form-group select {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            font-size: 14px;
            transition: var(--transition);
        }

        .settings-form .form-group input:focus,
        .settings-form .form-group select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(220, 53, 69, 0.1);
        }

        .settings-form .form-group small {
            display: block;
            margin-top: 5px;
            color: #666;
            font-size: 0.8rem;
        }

        /* Toggle Switch */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-switch label {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: var(--transition);
            border-radius: 24px;
        }

        .toggle-switch label:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: var(--transition);
            border-radius: 50%;
        }

        .toggle-switch input:checked + label {
            background-color: var(--success-color);
        }

        .toggle-switch input:checked + label:before {
            transform: translateX(26px);
        }

        /* System Status */
        .system-status-section {
            background: var(--light-color);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #e9ecef;
        }

        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }

        .status-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.1rem;
        }

        .status-icon.online {
            background: var(--success-color);
        }

        .status-icon.offline {
            background: var(--danger-color);
        }

        .status-icon.warning {
            background: var(--warning-color);
        }

        .status-info {
            flex: 1;
        }

        .status-label {
            font-weight: 600;
            color: var(--dark-color);
            margin-bottom: 2px;
        }

        .status-value {
            color: #666;
            font-size: 0.9rem;
        }

        /* Notifications */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 10000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification-success {
            background: var(--success-color);
        }

        .notification-error {
            background: var(--danger-color);
        }

        .notification-info {
            background: var(--info-color);
        }

        .notification i {
            font-size: 1.1rem;
        }

        /* Audit Logs */
        .audit-controls {
            background: white;
            border-radius: var(--border-radius);
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: var(--shadow);
        }

        .control-group {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-group {
            flex: 1;
            min-width: 200px;
        }

        .filter-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark-color);
        }

        .filter-group select {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            font-size: 14px;
            transition: var(--transition);
        }

        .filter-group select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(220, 53, 69, 0.1);
        }

        .action-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        /* Log Statistics */
        .log-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .stat-item {
            background: white;
            border-radius: 12px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .stat-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.3rem;
        }

        .stat-icon.info {
            background: var(--info-color);
        }

        .stat-icon.warning {
            background: var(--warning-color);
        }

        .stat-icon.error {
            background: var(--danger-color);
        }

        .stat-icon.critical {
            background: #8b0000;
        }

        .stat-content {
            flex: 1;
        }

        .stat-number {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--dark-color);
            line-height: 1;
        }

        .stat-label {
            color: #666;
            font-size: 0.9rem;
            margin-top: 5px;
        }

        /* Logs Section */
        .logs-section {
            background: white;
            border-radius: var(--border-radius);
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: var(--shadow);
        }

        .logs-info {
            color: #666;
            font-size: 0.9rem;
        }

        .logs-table-container {
            overflow-x: auto;
            margin: 20px 0;
        }

        .logs-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }

        .logs-table th {
            background: var(--light-color);
            padding: 15px 12px;
            text-align: left;
            font-weight: 600;
            color: var(--dark-color);
            border-bottom: 2px solid #e9ecef;
        }

        .logs-table td {
            padding: 12px;
            border-bottom: 1px solid #e9ecef;
            vertical-align: top;
        }

        .logs-table tr:hover {
            background: var(--light-color);
        }

        .logs-table .log-level {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .logs-table .log-level.info {
            background: rgba(13, 202, 240, 0.1);
            color: var(--info-color);
        }

        .logs-table .log-level.warning {
            background: rgba(255, 193, 7, 0.1);
            color: var(--warning-color);
        }

        .logs-table .log-level.error {
            background: rgba(220, 53, 69, 0.1);
            color: var(--danger-color);
        }

        .logs-table .log-level.critical {
            background: rgba(139, 0, 0, 0.1);
            color: #8b0000;
        }

        /* Pagination */
        .pagination {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }

        .page-info {
            color: #666;
            font-weight: 600;
        }

        /* Real-time Monitor */
        .realtime-section {
            background: white;
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--shadow);
        }

        .monitor-controls {
            display: flex;
            gap: 15px;
        }

        .monitor-window {
            background: #1e1e1e;
            border-radius: 8px;
            margin-top: 20px;
            overflow: hidden;
            border: 1px solid #333;
        }

        .monitor-header {
            background: #2d2d2d;
            padding: 12px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #333;
        }

        .monitor-status {
            color: #fff;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .monitor-time {
            color: #ccc;
            font-family: monospace;
            font-size: 0.9rem;
        }

        .monitor-content {
            padding: 20px;
            min-height: 200px;
            max-height: 400px;
            overflow-y: auto;
            color: #fff;
            font-family: monospace;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .monitor-placeholder {
            text-align: center;
            color: #888;
            padding: 40px 20px;
        }

        .monitor-placeholder i {
            font-size: 3rem;
            margin-bottom: 15px;
            display: block;
        }

        .monitor-placeholder p {
            margin: 0;
            font-size: 1rem;
        }

        .log-entry {
            margin-bottom: 8px;
            padding: 8px 0;
            border-bottom: 1px solid #333;
        }

        .log-entry:last-child {
            border-bottom: none;
        }

        .log-timestamp {
            color: #888;
            margin-right: 10px;
        }

        .log-level-badge {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-right: 10px;
            text-transform: uppercase;
        }

        .log-level-badge.info {
            background: var(--info-color);
            color: white;
        }

        .log-level-badge.warning {
            background: var(--warning-color);
            color: white;
        }

        .log-level-badge.error {
            background: var(--danger-color);
            color: white;
        }

        .log-level-badge.critical {
            background: #8b0000;
            color: white;
        }

        .chart-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--shadow);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .chart-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--dark-color);
        }

        .chart-container {
            position: relative;
            height: 300px;
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .charts-section {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            :root {
                --sidebar-width: 0px;
            }
            
            .sidebar {
                transform: translateX(-100%);
            }
            
            .sidebar.show {
                transform: translateX(0);
                width: 280px;
            }
            
            .main-content {
                margin-left: 0;
                padding: 20px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .header-title {
                font-size: 1.2rem;
            }
            
            .header-subtitle {
                display: none;
            }
            
            .mobile-menu-btn {
                display: block;
            }
        }

        @media (max-width: 480px) {
            .header {
                padding: 0 15px;
            }
            
            .header-left {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }
            
            .header-right {
                flex-direction: column;
                gap: 10px;
            }
            
            .main-content {
                padding: 15px;
            }
            
            .stat-card {
                padding: 20px;
            }
        }
        
        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
        }
        
        /* Loading States */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px;
            color: #666;
        }
        
        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid #e9ecef;
            border-top: 2px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Agent Management Styles */
        .agent-management {
            background: white;
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--shadow);
        }
        
        /* Agent Status Overview */
        .agent-status-overview {
            margin-bottom: 30px;
        }
        
        .status-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .status-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 15px;
            transition: var(--transition);
        }
        
        .status-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        .status-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }
        
        .status-icon.online {
            background: var(--success-color);
        }
        
        .status-icon.busy {
            background: var(--warning-color);
        }
        
        .status-icon.offline {
            background: var(--secondary-color);
        }
        
        .status-icon.total {
            background: var(--primary-color);
        }
        
        .status-content {
            flex: 1;
        }
        
        .status-number {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--dark-color);
            margin-bottom: 5px;
        }
        
        .status-label {
            color: #666;
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        /* Agent Details Styles */
        .agent-selection {
            background: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
        }
        
        .agent-profile {
            background: white;
            border-radius: var(--border-radius);
            padding: 30px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
        }
        
        .profile-header {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .profile-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: var(--light-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            color: var(--primary-color);
        }
        
        .profile-info {
            flex: 1;
        }
        
        .profile-info h2 {
            margin-bottom: 5px;
            color: var(--dark-color);
        }
        
        .profile-info p {
            color: #666;
            margin-bottom: 15px;
        }
        
        .profile-status {
            display: flex;
            gap: 10px;
        }
        
        .status-badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .availability-badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .profile-actions {
            display: flex;
            gap: 10px;
        }
        
        .agent-metrics {
            margin-bottom: 30px;
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        
        .metric-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 15px;
            transition: var(--transition);
        }
        
        .metric-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        .metric-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }
        
        .metric-content {
            flex: 1;
        }
        
        .metric-number {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--dark-color);
            margin-bottom: 5px;
        }
        
        .metric-label {
            color: #666;
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .working-hours-chart {
            background: white;
            border-radius: var(--border-radius);
            padding: 30px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
        }
        
        .working-hours-chart h3 {
            margin-bottom: 20px;
            color: var(--dark-color);
        }
        
        .recent-activity {
            background: white;
            border-radius: var(--border-radius);
            padding: 30px;
            box-shadow: var(--shadow);
        }
        
        .recent-activity h3 {
            margin-bottom: 20px;
            color: var(--dark-color);
        }
        
        .activity-list {
            max-height: 400px;
            overflow-y: auto;
        }
        
        /* Customer Feedback Styles */
        .customer-feedback {
            background: white;
            border-radius: var(--border-radius);
            padding: 30px;
            box-shadow: var(--shadow);
            margin-top: 30px;
        }
        
        .customer-feedback h3 {
            margin-bottom: 20px;
            color: var(--dark-color);
        }
        
        .feedback-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .feedback-stat {
            background: var(--light-color);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #e9ecef;
        }
        
        .feedback-stat .stat-label {
            display: block;
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 5px;
        }
        
        .feedback-stat .stat-value {
            display: block;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
        }
        
        .feedback-list {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .feedback-item {
            background: var(--light-color);
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            transition: var(--transition);
        }
        
        .feedback-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .feedback-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .feedback-rating {
            display: flex;
            gap: 2px;
        }
        
        .feedback-star {
            color: #ffc107;
            font-size: 1.1rem;
        }
        
        .feedback-star.empty {
            color: #ddd;
        }
        
        .feedback-time {
            font-size: 0.85rem;
            color: #666;
        }
        
        .feedback-type {
            background: var(--primary-color);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .feedback-comment {
            color: #333;
            line-height: 1.5;
            margin-top: 10px;
        }
        
        .feedback-session {
            font-size: 0.85rem;
            color: #666;
            margin-top: 10px;
            font-family: monospace;
        }
        
        /* Fix table column widths and overflow */
        .table-responsive {
            overflow-x: auto;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
        }
        
        .table {
            width: 100%;
            border-collapse: collapse;
            min-width: 1200px; /* Ensure minimum width */
        }
        
        .table th,
        .table td {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            padding: 12px 8px;
            text-align: left;
            border-bottom: 1px solid #e9ecef;
        }
        
        /* Specific column widths */
        .table th:nth-child(1), .table td:nth-child(1) { min-width: 120px; } /* Username */
        .table th:nth-child(2), .table td:nth-child(2) { min-width: 200px; } /* Email */
        .table th:nth-child(3), .table td:nth-child(3) { min-width: 100px; } /* Role */
        .table th:nth-child(4), .table td:nth-child(4) { min-width: 80px; }  /* Status */
        .table th:nth-child(5), .table td:nth-child(5) { min-width: 100px; } /* Online Status */
        .table th:nth-child(6), .table td:nth-child(6) { min-width: 80px; }  /* Hours Today */
        .table th:nth-child(7), .table td:nth-child(7) { min-width: 80px; }  /* Total Hours */
        .table th:nth-child(8), .table td:nth-child(8) { min-width: 60px; }  /* Rating */
        .table th:nth-child(9), .table td:nth-child(9) { min-width: 100px; } /* Working Hours */
        .table th:nth-child(10), .table td:nth-child(10) { min-width: 80px; } /* Created */
        .table th:nth-child(11), .table td:nth-child(11) { min-width: 100px; } /* Last Login */
        .table th:nth-child(12), .table td:nth-child(12) { min-width: 120px; } /* Actions */
        
        /* Ensure status badges don't overflow */
        .status-badge,
        .role-badge,
        .online-status {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100px;
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        /* Online status colors */
        .online-status.online {
            background: #d4edda;
            color: #155724;
        }
        
        .online-status.offline {
            background: #f8d7da;
            color: #721c24;
        }
        
        .online-status.busy {
            background: #fff3cd;
            color: #856404;
        }
        
        .online-status.unknown {
            background: #e2e3e5;
            color: #383d41;
        }
        
        /* Enhanced Select Dropdown */
        .select-wrapper {
            position: relative;
            display: inline-block;
            width: 100%;
        }
        
        .enhanced-select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            background: white;
            font-size: 1rem;
            color: #495057;
            cursor: pointer;
            appearance: none;
            transition: all 0.3s ease;
        }
        
        .enhanced-select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(220, 53, 69, 0.1);
        }
        
        .enhanced-select:hover {
            border-color: #adb5bd;
        }
        
        .select-arrow {
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            pointer-events: none;
            color: #6c757d;
            transition: transform 0.3s ease;
        }
        
        .enhanced-select:focus + .select-arrow {
            transform: translateY(-50%) rotate(180deg);
        }
        
        /* Agent Details Section Styling */
        .agent-details-section {
            background: white;
            border-radius: var(--border-radius);
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: var(--shadow);
        }
        
        .agent-details-section h3 {
            color: var(--dark-color);
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--light-color);
        }
        
        .agent-metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .agent-metric-card {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid #dee2e6;
        }
        
        .agent-metric-number {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 8px;
        }
        
        .agent-metric-label {
            color: #6c757d;
            font-size: 0.9rem;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-left">
            <button class="mobile-menu-btn" onclick="toggleSidebar()">
                <i class="fas fa-bars"></i>
            </button>
            <div>
                <div class="header-title">ðŸ‘‘ Super Admin Dashboard</div>
                <div class="header-subtitle">Enterprise Support System Control Panel</div>
            </div>
        </div>
        <div class="header-right">
            <div class="user-info">
                <div class="user-avatar">
                    <i class="fas fa-user"></i>
                </div>
                <div>
                    <div>Welcome, {{ current_user.username }}</div>
                    <div style="font-size: 0.8rem; opacity: 0.8;">Super Administrator</div>
                </div>
            </div>
            <a href="/admin/logout" class="logout-btn">
                <i class="fas fa-sign-out-alt"></i> Logout
            </a>
        </div>
    </header>
    
    <!-- Sidebar -->
    <nav class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-title">Navigation Menu</div>
        </div>
        <div class="nav-menu">
            <div class="nav-item">
                <a href="#analytics" class="nav-link active" onclick="showTab('analytics')">
                    <i class="fas fa-chart-line"></i>
                    <span>Analytics Dashboard</span>
                </a>
            </div>
            <div class="nav-item">
                <a href="#users" class="nav-link" onclick="showTab('users')">
                    <i class="fas fa-users"></i>
                    <span>User Management</span>
                </a>
            </div>
            <div class="nav-item">
                <a href="#reports" class="nav-link" onclick="showTab('reports')">
                    <i class="fas fa-file-alt"></i>
                    <span>Performance Reports</span>
                </a>
            </div>
            <div class="nav-item">
                <a href="#agent-details" class="nav-link" onclick="showTab('agent-details')">
                    <i class="fas fa-user-tie"></i>
                    <span>Agent Details</span>
                </a>
                <a href="#settings" class="nav-link" onclick="showTab('settings')">
                    <i class="fas fa-cog"></i>
                    <span>System Settings</span>
                </a>
            </div>
            <div class="nav-item">
                <a href="#audit" class="nav-link" onclick="showTab('audit')">
                    <i class="fas fa-shield-alt"></i>
                    <span>Audit Logs</span>
                </a>
            </div>
        </div>
    </nav>
    
    <!-- Main Content -->
    <main class="main-content">
        <!-- Analytics Dashboard Tab -->
        <div id="analytics" class="tab-content active">
            <div class="page-header">
                <h1 class="page-title">Analytics Dashboard</h1>
                <p class="page-subtitle">Real-time system performance and key metrics</p>
            </div>
            
            <!-- Statistics Cards -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon primary">
                            <i class="fas fa-comments"></i>
                        </div>
                        <div class="stat-change" id="messageChange">
                            <i class="fas fa-minus"></i>
                            <span>0%</span>
                        </div>
                    </div>
                    <div class="stat-number" id="totalMessages">0</div>
                    <div class="stat-label">Total Messages Today</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon success">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-change" id="userChange">
                            <i class="fas fa-minus"></i>
                            <span>0%</span>
                        </div>
                    </div>
                    <div class="stat-number" id="activeUsers">0</div>
                    <div class="stat-label">Active Users</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon warning">
                            <i class="fas fa-exchange-alt"></i>
                        </div>
                        <div class="stat-change" id="escalationChange">
                            <i class="fas fa-minus"></i>
                            <span>0%</span>
                        </div>
                    </div>
                    <div class="stat-number" id="escalations">0</div>
                    <div class="stat-label">Escalations</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon info">
                            <i class="fas fa-heartbeat"></i>
                        </div>
                        <div class="stat-change" id="healthChange">
                            <i class="fas fa-minus"></i>
                            <span>0%</span>
                        </div>
                    </div>
                    <div class="stat-number" id="systemHealth">0%</div>
                    <div class="stat-label">System Health</div>
                </div>
            </div>
            
            <!-- Charts Section -->
            <div class="charts-section">
                <div class="chart-card">
                    <div class="chart-header">
                        <h3 class="chart-title">Message Activity (Last 7 Days)</h3>
                        <select id="chartPeriod" onchange="updateChart()">
                            <option value="7">7 Days</option>
                            <option value="30">30 Days</option>
                            <option value="90">90 Days</option>
                        </select>
                    </div>
                    <div class="chart-container">
                        <canvas id="messageChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-card">
                    <div class="chart-header">
                        <h3 class="chart-title">Intent Distribution</h3>
                    </div>
                    <div class="chart-container">
                        <canvas id="intentChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- User Management Tab -->
        <div id="users" class="tab-content">
            <div class="page-header">
                <h1 class="page-title">Agent & User Management</h1>
                <p class="page-subtitle">Manage agents, track performance, and monitor working hours</p>
            </div>
            
            <!-- Agent Management Section -->
            <div class="agent-management">
                <div class="section-header">
                    <h2 class="section-title">Agent Management</h2>
                    <button class="add-user-btn" onclick="toggleUserForm()">
                        <i class="fas fa-plus"></i> Add New Agent
                    </button>
                </div>
                
                <!-- Add User Form -->
                <div class="user-form" id="userForm">
                    <form id="addUserForm">
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="username">Username</label>
                                <input type="text" id="username" name="username" required>
                            </div>
                            <div class="form-group">
                                <label for="email">Email</label>
                                <input type="email" id="email" name="email" required>
                            </div>
                        </div>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="password">Password</label>
                                <input type="password" id="password" name="password" required>
                            </div>
                            <div class="form-group">
                                <label for="role">Role</label>
                                <select id="role" name="role" required>
                                    <option value="">Select Role</option>
                                    <option value="agent">Agent</option>
                                    <option value="super_admin">Super Admin</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-grid" id="agentFields" style="display: none;">
                            <div class="form-group">
                                <label for="firstName">First Name</label>
                                <input type="text" id="firstName" name="firstName">
                            </div>
                            <div class="form-group">
                                <label for="lastName">Last Name</label>
                                <input type="text" id="lastName" name="lastName">
                            </div>
                        </div>
                        <div class="form-grid" id="agentFields2" style="display: none;">
                            <div class="form-group">
                                <label for="hourlyRate">Hourly Rate ($)</label>
                                <input type="number" id="hourlyRate" name="hourlyRate" step="0.01" min="0">
                            </div>
                            <div class="form-group">
                                <label for="skills">Skills (comma-separated)</label>
                                <input type="text" id="skills" name="skills" placeholder="customer service, technical support, billing">
                            </div>
                        </div>
                        <div class="form-actions">
                            <button type="button" class="btn btn-secondary" onclick="toggleUserForm()">Cancel</button>
                            <button type="submit" class="btn btn-primary">Create User</button>
                        </div>
                    </form>
                </div>
                
                <!-- Agent Status Overview -->
                <div class="agent-status-overview">
                    <div class="status-cards">
                        <div class="status-card">
                            <div class="status-icon online">
                                <i class="fas fa-circle"></i>
                            </div>
                            <div class="status-content">
                                <div class="status-number" id="onlineAgents">0</div>
                                <div class="status-label">Online Agents</div>
                            </div>
                        </div>
                        <div class="status-card">
                            <div class="status-icon busy">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div class="status-content">
                                <div class="status-number" id="busyAgents">0</div>
                                <div class="status-label">Busy Agents</div>
                            </div>
                        </div>
                        <div class="status-card">
                            <div class="status-icon offline">
                                <i class="fas fa-circle"></i>
                            </div>
                            <div class="status-content">
                                <div class="status-number" id="offlineAgents">0</div>
                                <div class="status-label">Offline Agents</div>
                            </div>
                        </div>
                        <div class="status-card">
                            <div class="status-icon total">
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="status-content">
                                <div class="status-number" id="totalAgents">0</div>
                                <div class="status-label">Total Agents</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Users Table -->
                <div class="table-responsive">
                    <table class="users-table">
                        <thead>
                            <tr>
                                <th>Username</th>
                                <th>Email</th>
                                <th>Role</th>
                                <th>Status</th>
                                <th>Online Status</th>
                                <th>Hours Today</th>
                                <th>Total Hours</th>
                                <th>Rating</th>
                                <th>Working Hours</th>
                                <th>Created</th>
                                <th>Last Login</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="usersTableBody">
                            <tr>
                                <td colspan="12" class="loading">
                                    <div class="spinner"></div>
                                    Loading users...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Performance Reports Tab -->
        <div id="reports" class="tab-content">
            <div class="page-header">
                <h1 class="page-title">Performance Reports</h1>
                <p class="page-subtitle">Detailed analytics and insights</p>
            </div>
            
            <!-- Performance Metrics Section -->
            <div class="performance-section">
                <div class="section-header">
                    <h2 class="section-title">Performance Metrics</h2>
                    <div class="report-controls">
                        <select id="reportPeriod" onchange="updatePerformanceReport()">
                            <option value="7">Last 7 Days</option>
                            <option value="30">Last 30 Days</option>
                            <option value="90">Last 90 Days</option>
                        </select>
                        <button class="btn btn-primary" onclick="exportReport()">
                            <i class="fas fa-download"></i> Export Report
                        </button>
                    </div>
                </div>
                
                <!-- Performance Cards -->
                <div class="performance-grid">
                    <div class="performance-card">
                        <div class="performance-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="performance-content">
                            <div class="performance-number" id="avgResponseTime">0s</div>
                            <div class="performance-label">Avg Response Time</div>
                            <div class="performance-trend" id="responseTimeTrend">Loading...</div>
                        </div>
                    </div>
                    
                    <div class="performance-card">
                        <div class="performance-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="performance-content">
                            <div class="performance-number" id="resolutionRate">0%</div>
                            <div class="performance-label">Resolution Rate</div>
                            <div class="performance-trend" id="resolutionTrend">Loading...</div>
                        </div>
                    </div>
                    
                    <div class="performance-card">
                        <div class="performance-icon">
                            <i class="fas fa-smile"></i>
                        </div>
                        <div class="performance-content">
                            <div class="performance-number" id="satisfactionScore">0/10</div>
                            <div class="performance-label">Satisfaction Score</div>
                            <div class="performance-trend" id="satisfactionTrend">Loading...</div>
                        </div>
                    </div>
                    
                    <div class="performance-card">
                        <div class="performance-icon">
                            <i class="fas fa-robot"></i>
                        </div>
                        <div class="performance-content">
                            <div class="performance-number" id="aiEfficiency">0%</div>
                            <div class="performance-label">AI Efficiency</div>
                            <div class="performance-trend" id="aiEfficiencyTrend">Loading...</div>
                        </div>
                    </div>
                </div>
                
                <!-- Performance Charts -->
                <div class="performance-charts">
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3 class="chart-title">Response Time Trends</h3>
                            <div class="chart-legend">
                                <span class="legend-item">
                                    <span class="legend-color ai"></span> AI Response
                                </span>
                                <span class="legend-item">
                                    <span class="legend-color human"></span> Human Response
                                </span>
                            </div>
                        </div>
                        <div class="chart-container">
                            <canvas id="responseTimeChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3 class="chart-title">Issue Resolution Timeline</h3>
                        </div>
                        <div class="chart-container">
                            <canvas id="resolutionChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Agent Details Tab -->
        <div id="agent-details" class="tab-content">
            <div class="page-header">
                <h1 class="page-title">Agent Details & Analytics</h1>
                <p class="page-subtitle">Detailed view of individual agent performance and working hours</p>
            </div>
            
            <!-- Agent Selection -->
            <div class="agent-selection">
                <div class="form-group">
                    <label for="agentSelect">Select Agent:</label>
                    <div class="select-wrapper">
                        <select id="agentSelect" onchange="loadAgentDetails()" class="enhanced-select">
                            <option value="">Choose an agent...</option>
                        </select>
                        <div class="select-arrow">
                            <i class="fas fa-chevron-down"></i>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Agent Details Content -->
            <div id="agentDetailsContent" style="display: none;">
                <!-- Agent Profile -->
                <div class="agent-profile">
                    <div class="profile-header">
                        <div class="profile-avatar">
                            <i class="fas fa-user-circle"></i>
                        </div>
                        <div class="profile-info">
                            <h2 id="agentName">Agent Name</h2>
                            <p id="agentEmail">agent@email.com</p>
                            <div class="profile-status">
                                <span id="agentStatus" class="status-badge">Offline</span>
                                <span id="agentAvailability" class="availability-badge">Unavailable</span>
                            </div>
                        </div>
                        <div class="profile-actions">
                            <button class="btn btn-primary" onclick="viewAgentChats()">
                                <i class="fas fa-comments"></i> View Chats
                            </button>
                            <button class="btn btn-secondary" onclick="exportAgentReport()">
                                <i class="fas fa-download"></i> Export Report
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Performance Metrics -->
                <div class="agent-metrics">
                    <div class="metrics-grid">
                        <div class="metric-card">
                            <div class="metric-icon">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div class="metric-content">
                                <div class="metric-number" id="agentHoursToday">Loading...</div>
                                <div class="metric-label">Hours Today</div>
                            </div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-icon">
                                <i class="fas fa-calendar-week"></i>
                            </div>
                            <div class="metric-content">
                                <div class="metric-number" id="agentHoursWeek">Loading...</div>
                                <div class="metric-label">Hours This Week</div>
                            </div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-icon">
                                <i class="fas fa-calendar-alt"></i>
                            </div>
                            <div class="metric-content">
                                <div class="metric-number" id="agentHoursMonth">Loading...</div>
                                <div class="metric-label">Hours This Month</div>
                            </div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-icon">
                                <i class="fas fa-star"></i>
                            </div>
                            <div class="metric-content">
                                <div class="metric-number" id="agentRating">Loading...</div>
                                <div class="metric-label">Average Rating</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Working Hours Chart -->
                <div class="working-hours-chart">
                    <h3>Working Hours (Last 7 Days)</h3>
                    <canvas id="agentHoursChart" width="400" height="200"></canvas>
                </div>
                
                <!-- Recent Activity -->
                <div class="recent-activity">
                    <h3>Recent Activity</h3>
                    <div class="activity-list" id="agentActivityList">
                        <div class="loading-placeholder">
                            <i class="fas fa-spinner fa-spin"></i>
                            <span>Loading agent activity...</span>
                        </div>
                    </div>
                </div>
                
                <!-- Customer Feedback -->
                <div class="customer-feedback">
                    <h3>Customer Feedback</h3>
                    <div class="feedback-stats">
                        <div class="feedback-stat">
                            <span class="stat-label">Total Feedback:</span>
                            <span class="stat-value" id="totalFeedback">0</span>
                        </div>
                        <div class="feedback-stat">
                            <span class="stat-label">Average Rating:</span>
                            <span class="stat-value" id="avgRating">Loading...</span>
                        </div>
                        <div class="feedback-stat">
                            <span class="stat-label">Positive (4-5â˜…):</span>
                            <span class="stat-value" id="positiveFeedback">0</span>
                        </div>
                    </div>
                    
                    <div class="feedback-list" id="agentFeedbackList">
                        <div class="loading-placeholder">
                            <i class="fas fa-spinner fa-spin"></i>
                            <span>Loading customer feedback...</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- System Settings Tab -->
        <div id="settings" class="tab-content">
            <div class="page-header">
                <h1 class="page-title">System Settings</h1>
                <p class="page-subtitle">Configure system parameters and behavior</p>
            </div>
            
            <!-- System Configuration Section -->
            <div class="settings-section">
                <div class="section-header">
                    <h2 class="section-title">System Configuration</h2>
                    <button class="btn btn-primary" onclick="saveAllSettings()">
                        <i class="fas fa-save"></i> Save All Changes
                    </button>
                </div>
                
                <!-- Settings Grid -->
                <div class="settings-grid">
                    <!-- AI Configuration -->
                    <div class="settings-card">
                        <div class="settings-card-header">
                            <h3><i class="fas fa-robot"></i> AI Configuration</h3>
                        </div>
                        <div class="settings-form">
                            <div class="form-group">
                                <label for="openaiApiKey">OpenAI API Key</label>
                                <input type="password" id="openaiApiKey" placeholder="sk-..." value="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
                                <small>Your OpenAI API key for AI-powered responses</small>
                            </div>
                            <div class="form-group">
                                <label for="aiModel">AI Model</label>
                                <select id="aiModel">
                                    <option value="gpt-3.5-turbo">GPT-3.5 Turbo</option>
                                    <option value="gpt-4">GPT-4</option>
                                    <option value="gpt-4-turbo">GPT-4 Turbo</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="maxTokens">Max Tokens</label>
                                <input type="number" id="maxTokens" value="150" min="50" max="1000">
                                <small>Maximum tokens for AI responses</small>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Chat Configuration -->
                    <div class="settings-card">
                        <div class="settings-card-header">
                            <h3><i class="fas fa-comments"></i> Chat Configuration</h3>
                        </div>
                        <div class="settings-form">
                            <div class="form-group">
                                <label for="escalationThreshold">Escalation Threshold</label>
                                <input type="number" id="escalationThreshold" value="0.7" min="0.1" max="1.0" step="0.1">
                                <small>AI confidence threshold for human escalation (0.1 - 1.0)</small>
                            </div>
                            <div class="form-group">
                                <label for="sessionTimeout">Session Timeout (minutes)</label>
                                <input type="number" id="sessionTimeout" value="30" min="5" max="120">
                                <small>Inactive session timeout period</small>
                            </div>
                            <div class="form-group">
                                <label for="maxMessages">Max Messages per Session</label>
                                <input type="number" id="maxMessages" value="50" min="10" max="200">
                                <small>Maximum messages allowed per chat session</small>
                            </div>
                        </div>
                    </div>
                    
                    <!-- System Preferences -->
                    <div class="settings-card">
                        <div class="settings-card-header">
                            <h3><i class="fas fa-cog"></i> System Preferences</h3>
                        </div>
                        <div class="settings-form">
                            <div class="form-group">
                                <label for="timezone">System Timezone</label>
                                <select id="timezone">
                                    <option value="UTC">UTC</option>
                                    <option value="America/New_York">Eastern Time</option>
                                    <option value="America/Chicago">Central Time</option>
                                    <option value="America/Denver">Mountain Time</option>
                                    <option value="America/Los_Angeles">Pacific Time</option>
                                    <option value="Europe/London">London</option>
                                    <option value="Asia/Tokyo">Tokyo</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="language">Default Language</label>
                                <select id="language">
                                    <option value="en">English</option>
                                    <option value="es">Spanish</option>
                                    <option value="fr">French</option>
                                    <option value="de">German</option>
                                    <option value="ja">Japanese</option>
                                    <option value="zh">Chinese</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="maintenanceMode">Maintenance Mode</label>
                                <div class="toggle-switch">
                                    <input type="checkbox" id="maintenanceMode">
                                    <label for="maintenanceMode"></label>
                                </div>
                                <small>Enable maintenance mode to restrict access</small>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Security Settings -->
                    <div class="settings-card">
                        <div class="settings-card-header">
                            <h3><i class="fas fa-shield-alt"></i> Security Settings</h3>
                        </div>
                        <div class="settings-form">
                            <div class="form-group">
                                <label for="passwordPolicy">Password Policy</label>
                                <select id="passwordPolicy">
                                    <option value="low">Low (6+ characters)</option>
                                    <option value="medium">Medium (8+ characters, mixed case)</option>
                                    <option value="high">High (10+ characters, symbols, numbers)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="sessionDuration">Session Duration (hours)</label>
                                <input type="number" id="sessionDuration" value="8" min="1" max="24">
                                <small>How long user sessions remain active</small>
                            </div>
                            <div class="form-group">
                                <label for="twoFactorAuth">Two-Factor Authentication</label>
                                <div class="toggle-switch">
                                    <input type="checkbox" id="twoFactorAuth">
                                    <label for="twoFactorAuth"></label>
                                </div>
                                <small>Require 2FA for all admin accounts</small>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- System Status -->
                <div class="system-status-section">
                    <div class="section-header">
                        <h2 class="section-title">System Status</h2>
                        <button class="btn btn-secondary" onclick="refreshSystemStatus()">
                            <i class="fas fa-sync"></i> Refresh
                        </button>
                    </div>
                    
                    <div class="status-grid">
                        <div class="status-item">
                            <div class="status-icon online">
                                <i class="fas fa-database"></i>
                            </div>
                            <div class="status-info">
                                <div class="status-label">Database</div>
                                <div class="status-value">Connected</div>
                            </div>
                        </div>
                        
                        <div class="status-item">
                            <div class="status-icon online">
                                <i class="fas fa-robot"></i>
                            </div>
                            <div class="status-info">
                                <div class="status-label">OpenAI API</div>
                                <div class="status-value">Active</div>
                            </div>
                        </div>
                        
                        <div class="status-item">
                            <div class="status-icon online">
                                <i class="fas fa-wifi"></i>
                            </div>
                            <div class="status-info">
                                <div class="status-label">WebSocket</div>
                                <div class="status-value">Connected</div>
                            </div>
                        </div>
                        
                        <div class="status-item">
                            <div class="status-icon online">
                                <i class="fas fa-server"></i>
                            </div>
                            <div class="status-info">
                                <div class="status-label">System</div>
                                <div class="status-value">Healthy</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Audit Logs Tab -->
        <div id="audit" class="tab-content">
            <div class="page-header">
                <h1 class="page-title">Audit Logs</h1>
                <p class="page-subtitle">Track all system activities and changes</p>
            </div>
            
            <!-- Audit Controls Section -->
            <div class="audit-controls">
                <div class="control-group">
                    <div class="filter-group">
                        <label for="logLevel">Log Level</label>
                        <select id="logLevel" onchange="filterLogs()">
                            <option value="all">All Levels</option>
                            <option value="info">Info</option>
                            <option value="warning">Warning</option>
                            <option value="error">Error</option>
                            <option value="critical">Critical</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label for="logCategory">Category</label>
                        <select id="logCategory" onchange="filterLogs()">
                            <option value="all">All Categories</option>
                            <option value="user">User Management</option>
                            <option value="chat">Chat System</option>
                            <option value="system">System Operations</option>
                            <option value="security">Security Events</option>
                            <option value="ai">AI Operations</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label for="dateRange">Date Range</label>
                        <select id="dateRange" onchange="filterLogs()">
                            <option value="today">Today</option>
                            <option value="yesterday">Yesterday</option>
                            <option value="week">Last 7 Days</option>
                            <option value="month">Last 30 Days</option>
                            <option value="custom">Custom Range</option>
                        </select>
                    </div>
                </div>
                
                <div class="action-group">
                    <button class="btn btn-secondary" onclick="refreshLogs()">
                        <i class="fas fa-sync"></i> Refresh
                    </button>
                    <button class="btn btn-primary" onclick="exportLogs()">
                        <i class="fas fa-download"></i> Export Logs
                    </button>
                    <button class="btn btn-danger" onclick="clearLogs()">
                        <i class="fas fa-trash"></i> Clear Old Logs
                    </button>
                </div>
            </div>
            
            <!-- Log Statistics -->
            <div class="log-stats">
                <div class="stat-item">
                    <div class="stat-icon info">
                        <i class="fas fa-info-circle"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-number" id="infoCount">0</div>
                        <div class="stat-label">Info Logs</div>
                    </div>
                </div>
                
                <div class="stat-item">
                    <div class="stat-icon warning">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-number" id="warningCount">0</div>
                        <div class="stat-label">Warnings</div>
                    </div>
                </div>
                
                <div class="stat-item">
                    <div class="stat-icon error">
                        <i class="fas fa-times-circle"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-number" id="errorCount">0</div>
                        <div class="stat-label">Errors</div>
                    </div>
                </div>
                
                <div class="stat-item">
                    <div class="stat-icon critical">
                        <i class="fas fa-radiation"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-number" id="criticalCount">0</div>
                        <div class="stat-label">Critical</div>
                    </div>
                </div>
            </div>
            
            <!-- Logs Table -->
            <div class="logs-section">
                <div class="section-header">
                    <h2 class="section-title">System Logs</h2>
                    <div class="logs-info">
                        <span id="totalLogs">0</span> total logs
                    </div>
                </div>
                
                <div class="logs-table-container">
                    <table class="logs-table">
                        <thead>
                            <tr>
                                <th>Timestamp</th>
                                <th>Level</th>
                                <th>Category</th>
                                <th>User</th>
                                <th>Action</th>
                                <th>Details</th>
                                <th>IP Address</th>
                            </tr>
                        </thead>
                        <tbody id="logsTableBody">
                            <!-- Logs will be populated here -->
                        </tbody>
                    </table>
                </div>
                
                <!-- Pagination -->
                <div class="pagination">
                    <button class="btn btn-secondary" onclick="previousPage()" id="prevBtn">
                        <i class="fas fa-chevron-left"></i> Previous
                    </button>
                    <div class="page-info">
                        Page <span id="currentPage">1</span> of <span id="totalPages">1</span>
                    </div>
                    <button class="btn btn-secondary" onclick="nextPage()" id="nextBtn">
                        Next <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>
            
            <!-- Real-time Log Monitor -->
            <div class="realtime-section">
                <div class="section-header">
                    <h2 class="section-title">Real-time Monitor</h2>
                    <div class="monitor-controls">
                        <button class="btn btn-success" onclick="startMonitoring()" id="startBtn">
                            <i class="fas fa-play"></i> Start Monitoring
                        </button>
                        <button class="btn btn-danger" onclick="stopMonitoring()" id="stopBtn" style="display: none;">
                            <i class="fas fa-stop"></i> Stop Monitoring
                        </button>
                    </div>
                </div>
                
                <div class="monitor-window" id="monitorWindow">
                    <div class="monitor-header">
                        <span class="monitor-status" id="monitorStatus">Stopped</span>
                        <span class="monitor-time" id="monitorTime">--:--:--</span>
                    </div>
                    <div class="monitor-content" id="monitorContent">
                        <div class="monitor-placeholder">
                            <i class="fas fa-terminal"></i>
                            <p>Click "Start Monitoring" to begin real-time log monitoring</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <script>
        // Global variables
        let currentTab = 'analytics';
        let messageChart = null;
        let intentChart = null;
        let responseTimeChart = null;
        let resolutionChart = null;
        
        // Tab management
        function showTab(tabName) {
            // Show loading state
            const mainContent = document.querySelector('.main-content');
            mainContent.style.opacity = '0.6';
            
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all nav links
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            
            // Add active class to clicked nav link
            event.target.classList.add('active');
            
            currentTab = tabName;
            
            // Load tab-specific data with loading state
            setTimeout(() => {
            loadTabData(tabName);
                mainContent.style.opacity = '1';
            }, 300);
        }
        
        // Load data for specific tabs
        function loadTabData(tabName) {
            switch(tabName) {
                case 'analytics':
                    loadAnalyticsData();
                    break;
                case 'users':
                    loadUsers();
                    break;
                case 'reports':
                    loadPerformanceData();
                    break;
                case 'settings':
                    loadSettings();
                    break;
                case 'audit':
                    loadAuditLogs();
                    break;
                case 'agent-details':
                    populateAgentSelect();
                    break;
            }
        }
        
        // Toggle sidebar on mobile
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const button = event.target.closest('button');
            
            if (sidebar.classList.contains('show')) {
                // Hide sidebar
                sidebar.classList.remove('show');
                button.innerHTML = '<i class="fas fa-bars"></i>';
            } else {
                // Show sidebar with loading state
                button.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
                button.disabled = true;
                
                // Simulate sidebar load delay
                setTimeout(() => {
                    sidebar.classList.add('show');
                    button.innerHTML = '<i class="fas fa-times"></i>';
                    button.disabled = false;
                }, 300);
            }
        }
        
        // Load analytics data
        async function loadAnalyticsData() {
            try {
                // Show loading state
                document.getElementById('totalMessages').textContent = 'Loading...';
                document.getElementById('activeUsers').textContent = 'Loading...';
                document.getElementById('escalations').textContent = 'Loading...';
                document.getElementById('systemHealth').textContent = 'Loading...';
                
                const response = await fetch('/api/analytics', {
                    credentials: 'include'
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error);
                }
                
                // Update stats with real data
                const totalMessages = data.total_messages || 0;
                const escalatedCount = data.escalated_count || 0;
                const avgConfidence = data.avg_confidence || 0;
                
                document.getElementById('totalMessages').textContent = totalMessages;
                document.getElementById('escalations').textContent = escalatedCount;
                
                // Calculate system health based on AI confidence
                const healthScore = Math.round(avgConfidence * 100);
                document.getElementById('systemHealth').textContent = healthScore + '%';
                
                // Estimate active users based on message activity
                const activeUsers = Math.min(totalMessages, 50); // Simple estimation
                document.getElementById('activeUsers').textContent = activeUsers;
                
                // Calculate trends (compare with previous period)
                await calculateTrends();
                
                // Initialize charts with real data
                initializeCharts(data);
                
            } catch (error) {
                console.error('Failed to load analytics data:', error);
                // Show error state
                document.getElementById('totalMessages').textContent = 'Error';
                document.getElementById('activeUsers').textContent = 'Error';
                document.getElementById('escalations').textContent = 'Error';
                document.getElementById('systemHealth').textContent = 'Error';
                
                // Show error notification
                showNotification('Failed to load analytics data. Please refresh the page.', 'error');
            }
        }
        
        // Calculate trends by comparing with previous period
        async function calculateTrends() {
            try {
                // Get data for previous period (yesterday)
                const yesterday = new Date();
                yesterday.setDate(yesterday.getDate() - 1);
                
                const response = await fetch(`/api/analytics?date=${yesterday.toISOString().split('T')[0]}`, {
                    credentials: 'include'
                });
                const prevData = await response.json();
                
                // Calculate percentage changes
                const currentMessages = parseInt(document.getElementById('totalMessages').textContent) || 0;
                const prevMessages = prevData.total_messages || 0;
                const messageChange = prevMessages > 0 ? ((currentMessages - prevMessages) / prevMessages * 100) : 0;
                
                const currentEscalations = parseInt(document.getElementById('escalations').textContent) || 0;
                const prevEscalations = prevData.escalated_count || 0;
                const escalationChange = prevEscalations > 0 ? ((currentEscalations - prevEscalations) / prevEscalations * 100) : 0;
                
                const currentHealth = parseInt(document.getElementById('systemHealth').textContent) || 0;
                const prevHealth = Math.round((prevData.avg_confidence || 0) * 100);
                const healthChange = prevHealth > 0 ? ((currentHealth - prevHealth) / prevHealth * 100) : 0;
                
                // Update trend indicators
                updateTrendIndicator('messageChange', messageChange);
                updateTrendIndicator('escalationChange', escalationChange);
                updateTrendIndicator('healthChange', healthChange);
                
                // For active users, use a simple trend
                const userChange = messageChange > 0 ? Math.min(messageChange * 0.5, 10) : 0;
                updateTrendIndicator('userChange', userChange);
                
            } catch (error) {
                console.error('Failed to calculate trends:', error);
                // Show no change indicators
                updateTrendIndicator('messageChange', 0);
                updateTrendIndicator('userChange', 0);
                updateTrendIndicator('escalationChange', 0);
                updateTrendIndicator('healthChange', 0);
            }
        }
        
        // Update trend indicator with proper styling
        function updateTrendIndicator(elementId, change) {
            const element = document.getElementById(elementId);
            const icon = element.querySelector('i');
            const span = element.querySelector('span');
            
            if (change > 0) {
                element.className = 'stat-change positive';
                icon.className = 'fas fa-arrow-up';
                span.textContent = `+${change.toFixed(1)}%`;
            } else if (change < 0) {
                element.className = 'stat-change negative';
                icon.className = 'fas fa-arrow-down';
                span.textContent = `${change.toFixed(1)}%`;
            } else {
                element.className = 'stat-change';
                icon.className = 'fas fa-minus';
                span.textContent = '0%';
            }
        }
        
        // Initialize charts
        function initializeCharts(data) {
            // Message Activity Chart
            const messageCtx = document.getElementById('messageChart').getContext('2d');
            if (messageChart) {
                messageChart.destroy();
            }
            
            // Get real data from backend or use empty data
            const messageData = data.message_activity || [0, 0, 0, 0, 0, 0, 0];
            const messageLabels = data.message_labels || ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
            
            // Check if we have any real data
            const hasData = messageData.some(value => value > 0);
            
            if (!hasData) {
                // Show empty state message
                const chartContainer = document.getElementById('messageChart').parentElement;
                chartContainer.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #666;">
                        <i class="fas fa-chart-line" style="font-size: 3rem; margin-bottom: 15px; opacity: 0.3;"></i>
                        <p>No message data available yet</p>
                        <small>Start chatting to see activity charts</small>
                    </div>
                `;
                return;
            }
            
            messageChart = new Chart(messageCtx, {
                type: 'line',
                data: {
                    labels: messageLabels,
                    datasets: [{
                        label: 'Messages',
                        data: messageData,
                        borderColor: '#dc3545',
                        backgroundColor: 'rgba(220, 53, 69, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Number of Messages'
                            }
                        }
                    }
                }
            });
            
            // Intent Distribution Chart
            const intentCtx = document.getElementById('intentChart').getContext('2d');
            if (intentChart) {
                intentChart.destroy();
            }
            
            // Get real intent data from backend or use empty data
            const intentData = data.intent_distribution || [];
            const intentLabels = intentData.map(item => item.intent) || [];
            const intentCounts = intentData.map(item => item.count) || [];
            
            // Check if we have any real intent data
            const hasIntentData = intentData.length > 0;
            
            if (!hasIntentData) {
                // Show empty state message
                const chartContainer = document.getElementById('intentChart').parentElement;
                chartContainer.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #666;">
                        <i class="fas fa-chart-pie" style="font-size: 3rem; margin-bottom: 15px; opacity: 0.3;"></i>
                        <p>No intent data available yet</p>
                        <small>Start chatting to see intent distribution</small>
                    </div>
                `;
                return;
            }
            
            intentChart = new Chart(intentCtx, {
                type: 'doughnut',
                data: {
                    labels: intentLabels,
                    datasets: [{
                        data: intentCounts,
                        backgroundColor: [
                            '#dc3545',
                            '#28a745',
                            '#ffc107',
                            '#17a2b8',
                            '#6c757d',
                            '#6f42c1',
                            '#fd7e14'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                        }
                    }
                }
            });
        }
        
        // Update chart period
        function updateChart() {
            // Show loading state
            const chartPeriod = document.getElementById('chartPeriod');
            const originalValue = chartPeriod.value;
            chartPeriod.disabled = true;
            
            // Show loading on charts
            const messageChartContainer = document.getElementById('messageChart').parentElement;
            const intentChartContainer = document.getElementById('intentChart').parentElement;
            
            messageChartContainer.innerHTML = `
                <div style="text-align: center; padding: 40px; color: #666;">
                    <div class="spinner"></div>
                    <p>Updating chart...</p>
                </div>
            `;
            
            intentChartContainer.innerHTML = `
                <div style="text-align: center; padding: 40px; color: #666;">
                    <div class="spinner"></div>
                    <p>Updating chart...</p>
                </div>
            `;
            
            // Simulate chart update delay
            setTimeout(() => {
                // Re-enable select
                chartPeriod.disabled = false;
                
                // Reload analytics data with new period
                loadAnalyticsData();
                
                console.log('Chart period updated to:', originalValue);
            }, 1000);
        }

        // Performance Reports Functions
        function updatePerformanceReport() {
            const period = document.getElementById('reportPeriod');
            const originalValue = period.value;
            period.disabled = true;
            
            // Show loading state
            const performanceCards = document.querySelectorAll('.performance-card');
            performanceCards.forEach(card => {
                const numberElement = card.querySelector('.performance-number');
                const trendElement = card.querySelector('.performance-trend');
                
                numberElement.textContent = 'Loading...';
                trendElement.textContent = 'Updating...';
            });
            
            // Load performance data with new period
            loadPerformanceData(parseInt(originalValue));
            
            // Re-enable select after loading
            setTimeout(() => {
                period.disabled = false;
            }, 1000);
        }

        async function loadPerformanceData(period = 7) {
            try {
                // Show loading state
                document.getElementById('avgResponseTime').textContent = 'Loading...';
                document.getElementById('resolutionRate').textContent = 'Loading...';
                document.getElementById('satisfactionScore').textContent = 'Loading...';
                document.getElementById('aiEfficiency').textContent = 'Loading...';
                
                // Show loading trends
                document.getElementById('responseTimeTrend').textContent = 'Loading...';
                document.getElementById('resolutionTrend').textContent = 'Loading...';
                document.getElementById('satisfactionTrend').textContent = 'Loading...';
                document.getElementById('aiEfficiencyTrend').textContent = 'Loading...';
                
                // Load real performance data from backend
                const response = await fetch(`/api/admin/performance?period=${period}`, {
                    credentials: 'include'
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error);
                }
                
                if (data.success) {
                    // Update performance cards with real data
                    document.getElementById('avgResponseTime').textContent = data.avgResponseTime || '0s';
                    document.getElementById('resolutionRate').textContent = data.resolutionRate || '0%';
                    document.getElementById('satisfactionScore').textContent = data.satisfactionScore || '0/10';
                    document.getElementById('aiEfficiency').textContent = data.aiEfficiency || '0%';
                    
                    // Update trends
                    document.getElementById('responseTimeTrend').textContent = data.responseTimeTrend || 'No data';
                    document.getElementById('resolutionTrend').textContent = data.resolutionTrend || 'No data';
                    document.getElementById('satisfactionTrend').textContent = data.satisfactionTrend || 'No data';
                    document.getElementById('aiEfficiencyTrend').textContent = data.aiEfficiencyTrend || 'No data';
                    
                    // Initialize performance charts with real data
                    initializePerformanceCharts(data);
                } else {
                    // Show no data message
                    document.getElementById('avgResponseTime').textContent = 'No data';
                    document.getElementById('resolutionRate').textContent = 'No data';
                    document.getElementById('satisfactionScore').textContent = 'No data';
                    document.getElementById('aiEfficiency').textContent = 'No data';
                    
                    // Show no data trends
                    document.getElementById('responseTimeTrend').textContent = 'No data';
                    document.getElementById('resolutionTrend').textContent = 'No data';
                    document.getElementById('satisfactionTrend').textContent = 'No data';
                    document.getElementById('aiEfficiencyTrend').textContent = 'No data';
                }
                
            } catch (error) {
                console.error('Failed to load performance data:', error);
                // Show error state
                document.getElementById('avgResponseTime').textContent = 'Error';
                document.getElementById('resolutionRate').textContent = 'Error';
                document.getElementById('satisfactionScore').textContent = 'Error';
                document.getElementById('aiEfficiency').textContent = 'Error';
                
                // Show error trends
                document.getElementById('responseTimeTrend').textContent = 'Error';
                document.getElementById('resolutionTrend').textContent = 'Error';
                document.getElementById('satisfactionTrend').textContent = 'Error';
                document.getElementById('aiEfficiencyTrend').textContent = 'Error';
                
                // Show error notification
                showNotification('Failed to load performance data. Please refresh the page.', 'error');
            }
        }

        function initializePerformanceCharts(data) {
            // Response Time Trends Chart
            const responseCtx = document.getElementById('responseTimeChart').getContext('2d');
            if (responseTimeChart) {
                responseTimeChart.destroy();
            }
            
            // Use real data if available, otherwise show empty chart
            const responseData = data.response_time_data || [0, 0, 0, 0, 0, 0, 0];
            const responseLabels = data.response_labels || ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
            
            responseTimeChart = new Chart(responseCtx, {
                type: 'line',
                data: {
                    labels: responseLabels,
                    datasets: [{
                        label: 'AI Response Time',
                        data: responseData,
                        borderColor: '#dc3545',
                        backgroundColor: 'rgba(220, 53, 69, 0.1)',
                        tension: 0.4
                    }, {
                        label: 'Human Response Time',
                        data: responseData.map(x => x * 2.5), // Estimate human response time
                        borderColor: '#28a745',
                        backgroundColor: 'rgba(40, 167, 69, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Response Time (seconds)'
                            }
                        }
                    }
                }
            });
            
            // Resolution Timeline Chart
            const resolutionCtx = document.getElementById('resolutionChart').getContext('2d');
            if (resolutionChart) {
                resolutionChart.destroy();
            }
            
            // Use real data if available, otherwise show empty chart
            const resolutionData = data.resolution_data || [0, 0, 0, 0, 0];
            const resolutionLabels = ['0-1h', '1-4h', '4-8h', '8-24h', '24h+'];
            
            resolutionChart = new Chart(resolutionCtx, {
                type: 'bar',
                data: {
                    labels: resolutionLabels,
                    datasets: [{
                        label: 'Issues Resolved',
                        data: resolutionData,
                        backgroundColor: '#17a2b8'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Number of Issues'
                            }
                        }
                    }
                }
            });
        }

        function exportReport() {
            // Show loading state
            const exportButton = event.target.closest('button');
            const originalText = exportButton.innerHTML;
            exportButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Exporting...';
            exportButton.disabled = true;
            
            // Simulate export delay
            setTimeout(() => {
                // Re-enable button
                exportButton.innerHTML = originalText;
                exportButton.disabled = false;
                
                // Show success message
                showNotification('Report export functionality will be implemented here. This would generate a PDF or Excel report.', 'info');
            }, 2000);
        }

        // System Settings Functions
        function saveAllSettings() {
            try {
                // Show loading state
                const saveButton = document.querySelector('.btn-primary[onclick="saveAllSettings()"]');
                const originalText = saveButton.innerHTML;
                saveButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
                saveButton.disabled = true;
                
            // Collect all settings values
            const settings = {
                openaiApiKey: document.getElementById('openaiApiKey').value,
                aiModel: document.getElementById('aiModel').value,
                maxTokens: document.getElementById('maxTokens').value,
                escalationThreshold: document.getElementById('escalationThreshold').value,
                sessionTimeout: document.getElementById('sessionTimeout').value,
                maxMessages: document.getElementById('maxMessages').value,
                timezone: document.getElementById('timezone').value,
                language: document.getElementById('language').value,
                maintenanceMode: document.getElementById('maintenanceMode').checked,
                passwordPolicy: document.getElementById('passwordPolicy').value,
                sessionDuration: document.getElementById('sessionDuration').value,
                twoFactorAuth: document.getElementById('twoFactorAuth').checked
            };
            
            // Save settings (in real app, this would send to backend)
            localStorage.setItem('systemSettings', JSON.stringify(settings));
                
                // Simulate backend save delay
                setTimeout(() => {
                    // Re-enable button
                    saveButton.innerHTML = originalText;
                    saveButton.disabled = false;
            
            // Show success message
            showNotification('Settings saved successfully!', 'success');
                }, 1000);
                
            } catch (error) {
                console.error('Failed to save settings:', error);
                
                // Re-enable button
                const saveButton = document.querySelector('.btn-primary[onclick="saveAllSettings()"]');
                saveButton.innerHTML = '<i class="fas fa-save"></i> Save All Changes';
                saveButton.disabled = false;
                
                // Show error message
                showNotification('Failed to save settings. Please try again.', 'error');
            }
        }

        function loadSettings() {
            try {
                // Show loading state
                const formElements = document.querySelectorAll('.settings-form input, .settings-form select');
                formElements.forEach(element => {
                    element.disabled = true;
                    element.style.opacity = '0.6';
                });
                
            // Load saved settings from localStorage
            const savedSettings = localStorage.getItem('systemSettings');
            if (savedSettings) {
                const settings = JSON.parse(savedSettings);
                
                // Apply settings to form fields
                Object.keys(settings).forEach(key => {
                    const element = document.getElementById(key);
                    if (element) {
                        if (element.type === 'checkbox') {
                            element.checked = settings[key];
                        } else {
                            element.value = settings[key];
                        }
                    }
                    });
                }
                
                // Re-enable form elements
                formElements.forEach(element => {
                    element.disabled = false;
                    element.style.opacity = '1';
                });
                
            } catch (error) {
                console.error('Failed to load settings:', error);
                showNotification('Failed to load settings. Please refresh the page.', 'error');
                
                // Re-enable form elements on error
                const formElements = document.querySelectorAll('.settings-form input, .settings-form select');
                formElements.forEach(element => {
                    element.disabled = false;
                    element.style.opacity = '1';
                });
            }
        }

        function refreshSystemStatus() {
            // Show loading state
            const statusItems = document.querySelectorAll('.status-item');
            statusItems.forEach(item => {
                const icon = item.querySelector('.status-icon');
                const value = item.querySelector('.status-value');
                
                // Show loading state
                icon.className = 'status-icon warning';
                value.textContent = 'Checking...';
            });
            
            // Check system status
            fetch('/api/admin/system-status')
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.success) {
                        // Update status based on real data
            statusItems.forEach(item => {
                const icon = item.querySelector('.status-icon');
                const value = item.querySelector('.status-value');
                
                            // Update to online status
                    icon.className = 'status-icon online';
                    value.textContent = 'Connected';
                        });
                        
                        showNotification('System status refreshed successfully!', 'success');
                    } else {
                        throw new Error(data.error || 'Failed to get system status');
                    }
                })
                .catch(error => {
                    console.error('Failed to refresh system status:', error);
                    
                    // Show error state
                    statusItems.forEach(item => {
                        const icon = item.querySelector('.status-icon');
                        const value = item.querySelector('.status-value');
                        
                        icon.className = 'status-icon offline';
                        value.textContent = 'Error';
                    });
                    
                    showNotification('Failed to refresh system status. Please try again.', 'error');
                });
        }

        function showNotification(message, type = 'info') {
            // Create notification element
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                <span>${message}</span>
            `;
            
            // Add to page
            document.body.appendChild(notification);
            
            // Show notification
            setTimeout(() => notification.classList.add('show'), 100);
            
            // Remove after 3 seconds
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // Audit Logs Functions
        let currentPage = 1;
        let logsPerPage = 20;
        let allLogs = [];
        let filteredLogs = [];
        let monitoringInterval = null;

        function loadAuditLogs() {
            // Show loading state
            const tbody = document.getElementById('logsTableBody');
            tbody.innerHTML = `
                <tr>
                    <td colspan="7" class="loading">
                        <div class="spinner"></div>
                        Loading audit logs...
                    </td>
                </tr>
            `;
            
            // Load real audit logs from backend
            fetch('/api/admin/audit-logs', {
                credentials: 'include'
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.success) {
                        allLogs = data.logs || [];
            // Apply filters and display
            filterLogs();
            // Update statistics
            updateLogStats();
                    } else {
                        throw new Error(data.error || 'Failed to load audit logs');
                    }
                })
                .catch(error => {
                    console.error('Failed to load audit logs:', error);
                    // Show error state
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="7" style="text-align: center; padding: 40px; color: #dc3545;">
                                <i class="fas fa-exclamation-triangle" style="font-size: 2rem; margin-bottom: 15px; display: block;"></i>
                                <p>Failed to load audit logs</p>
                                <small>Error: ${error.message}</small>
                                <br><br>
                                <button class="btn btn-primary" onclick="loadAuditLogs()">
                                    <i class="fas fa-sync"></i> Retry
                                </button>
                            </td>
                        </tr>
                    `;
                    
                    // Reset data
            allLogs = [];
                    updateLogStats();
                });
        }

        function filterLogs() {
            // Show loading state
            const logsTable = document.getElementById('logsTableBody');
            logsTable.innerHTML = `
                <tr>
                    <td colspan="7" class="loading">
                        <div class="spinner"></div>
                        Filtering logs...
                    </td>
                </tr>
            `;
            
            // Simulate filter delay
            setTimeout(() => {
            const levelFilter = document.getElementById('logLevel').value;
            const categoryFilter = document.getElementById('logCategory').value;
            const dateFilter = document.getElementById('dateRange').value;
            
            filteredLogs = allLogs.filter(log => {
                // Level filter
                if (levelFilter !== 'all' && log.level !== levelFilter) return false;
                
                // Category filter
                if (categoryFilter !== 'all' && log.category !== categoryFilter) return false;
                
                // Date filter
                const now = new Date();
                const logDate = new Date(log.timestamp);
                
                switch (dateFilter) {
                    case 'today':
                        if (logDate.toDateString() !== now.toDateString()) return false;
                        break;
                    case 'yesterday':
                        const yesterday = new Date(now);
                        yesterday.setDate(yesterday.getDate() - 1);
                        if (logDate.toDateString() !== yesterday.toDateString()) return false;
                        break;
                    case 'week':
                        const weekAgo = new Date(now);
                        weekAgo.setDate(weekAgo.getDate() - 7);
                        if (logDate < weekAgo) return false;
                        break;
                    case 'month':
                        const monthAgo = new Date(now);
                        monthAgo.setMonth(monthAgo.getMonth() - 1);
                        if (logDate < monthAgo) return false;
                        break;
                }
                
                return true;
            });
            
            currentPage = 1;
            displayLogs();
            updateLogStats();
            }, 500);
        }

        function displayLogs() {
            const tbody = document.getElementById('logsTableBody');
            const startIndex = (currentPage - 1) * logsPerPage;
            const endIndex = startIndex + logsPerPage;
            const pageLogs = filteredLogs.slice(startIndex, endIndex);
            
            tbody.innerHTML = '';
            
            if (pageLogs.length === 0) {
                // Show empty state
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 40px; color: #666;">
                            <i class="fas fa-clipboard-list" style="font-size: 2rem; margin-bottom: 15px; display: block; opacity: 0.3;"></i>
                            <p>No audit logs available</p>
                            <small>Start using the system to see activity logs</small>
                        </td>
                    </tr>
                `;
                return;
            }
            
            pageLogs.forEach(log => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${formatTimestamp(log.timestamp)}</td>
                    <td><span class="log-level ${log.level}">${log.level}</span></td>
                    <td>${log.category}</td>
                    <td>${log.user}</td>
                    <td>${log.action}</td>
                    <td>${log.details}</td>
                    <td>${log.ip}</td>
                `;
                tbody.appendChild(row);
            });
            
            updatePagination();
        }

        function formatTimestamp(timestamp) {
            return timestamp.toLocaleString();
        }

        function updatePagination() {
            const totalPages = Math.ceil(filteredLogs.length / logsPerPage);
            document.getElementById('currentPage').textContent = currentPage;
            document.getElementById('totalPages').textContent = totalPages;
            document.getElementById('totalLogs').textContent = filteredLogs.length;
            
            // Update button states
            document.getElementById('prevBtn').disabled = currentPage === 1;
            document.getElementById('nextBtn').disabled = currentPage === totalPages;
        }

        function previousPage() {
            if (currentPage > 1) {
                // Show loading state
                const prevBtn = document.getElementById('prevBtn');
                const originalText = prevBtn.innerHTML;
                prevBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
                prevBtn.disabled = true;
                
                currentPage--;
                
                // Simulate page load delay
                setTimeout(() => {
                displayLogs();
                    prevBtn.innerHTML = originalText;
                    prevBtn.disabled = false;
                }, 300);
            }
        }

        function nextPage() {
            const totalPages = Math.ceil(filteredLogs.length / logsPerPage);
            if (currentPage < totalPages) {
                // Show loading state
                const nextBtn = document.getElementById('nextBtn');
                const originalText = nextBtn.innerHTML;
                nextBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
                nextBtn.disabled = true;
                
                currentPage++;
                
                // Simulate page load delay
                setTimeout(() => {
                displayLogs();
                    nextBtn.innerHTML = originalText;
                    nextBtn.disabled = false;
                }, 300);
            }
        }

        function updateLogStats() {
            const stats = {
                info: 0,
                warning: 0,
                error: 0,
                critical: 0
            };
            
            filteredLogs.forEach(log => {
                stats[log.level]++;
            });
            
            document.getElementById('infoCount').textContent = stats.info;
            document.getElementById('warningCount').textContent = stats.warning;
            document.getElementById('errorCount').textContent = stats.error;
            document.getElementById('criticalCount').textContent = stats.critical;
        }

        function refreshLogs() {
            // Show loading state
            const refreshButton = event.target.closest('button');
            const originalText = refreshButton.innerHTML;
            refreshButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Refreshing...';
            refreshButton.disabled = true;
            
            // Reload logs
            loadAuditLogs();
            
            // Re-enable button after a short delay
            setTimeout(() => {
                refreshButton.innerHTML = originalText;
                refreshButton.disabled = false;
            showNotification('Logs refreshed successfully!', 'success');
            }, 1000);
        }

        function exportLogs() {
            // Show loading state
            const exportButton = event.target.closest('button');
            const originalText = exportButton.innerHTML;
            exportButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Exporting...';
            exportButton.disabled = true;
            
            try {
            // Create CSV content
            let csv = 'Timestamp,Level,Category,User,Action,Details,IP Address\n';
            
            filteredLogs.forEach(log => {
                csv += `"${formatTimestamp(log.timestamp)}","${log.level}","${log.category}","${log.user}","${log.action}","${log.details}","${log.ip}"\n`;
            });
            
            // Download file
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `audit_logs_${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            window.URL.revokeObjectURL(url);
            
            showNotification('Logs exported successfully!', 'success');
                
            } catch (error) {
                console.error('Failed to export logs:', error);
                showNotification('Failed to export logs. Please try again.', 'error');
            } finally {
                // Re-enable button
                exportButton.innerHTML = originalText;
                exportButton.disabled = false;
            }
        }

        function clearLogs() {
            if (confirm('Are you sure you want to clear old logs? This action cannot be undone.')) {
                // Show loading state
                const clearButton = event.target.closest('button');
                const originalText = clearButton.innerHTML;
                clearButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Clearing...';
                clearButton.disabled = true;
                
                // In a real app, this would send a request to the backend
                setTimeout(() => {
                allLogs = allLogs.filter(log => {
                    const logDate = new Date(log.timestamp);
                    const weekAgo = new Date();
                    weekAgo.setDate(weekAgo.getDate() - 7);
                    return logDate > weekAgo;
                });
                
                filterLogs();
                    
                    // Re-enable button
                    clearButton.innerHTML = originalText;
                    clearButton.disabled = false;
                    
                showNotification('Old logs cleared successfully!', 'success');
                }, 2000);
            }
        }

        // Real-time Monitoring Functions
        function startMonitoring() {
            document.getElementById('startBtn').style.display = 'none';
            document.getElementById('stopBtn').style.display = 'inline-block';
            document.getElementById('monitorStatus').textContent = 'Starting...';
            document.getElementById('monitorStatus').style.color = '#ffc107';
            
            // Clear placeholder and show loading
            document.getElementById('monitorContent').innerHTML = `
                <div class="monitor-placeholder">
                    <i class="fas fa-spinner fa-spin" style="font-size: 3rem; margin-bottom: 15px; display: block;"></i>
                    <p>Starting real-time monitoring...</p>
                </div>
            `;
            
            // Start monitoring interval
            monitoringInterval = setInterval(() => {
                addLogEntry();
                updateMonitorTime();
            }, 2000);
            
            // Update status after first entry
            setTimeout(() => {
                document.getElementById('monitorStatus').textContent = 'Monitoring';
                document.getElementById('monitorStatus').style.color = '#28a745';
            }, 2000);
            
            showNotification('Real-time monitoring started!', 'success');
        }

        function stopMonitoring() {
            document.getElementById('startBtn').style.display = 'inline-block';
            document.getElementById('stopBtn').style.display = 'none';
            document.getElementById('monitorStatus').textContent = 'Stopped';
            document.getElementById('monitorStatus').style.color = '#dc3545';
            
            // Clear interval
            if (monitoringInterval) {
                clearInterval(monitoringInterval);
                monitoringInterval = null;
            }
            
            showNotification('Real-time monitoring stopped!', 'info');
        }

        function addLogEntry() {
            const monitorContent = document.getElementById('monitorContent');
            
            // Get real system status instead of fake data
            fetch('/api/admin/system-status', {
                credentials: 'include'
            })
                    .then(response => response.json())
                    .then(data => {
                    if (data.success) {
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            logEntry.innerHTML = `
                            <span class="log-timestamp">[${new Date().toLocaleTimeString()}]</span>
                            <span class="log-level-badge ${data.level || 'info'}">${data.level || 'info'}</span>
                            <span>[${data.category || 'system'}]</span>
                            <span>${data.message || 'Status check'}</span>
            `;
            
            monitorContent.appendChild(logEntry);
            
            // Auto-scroll to bottom
            monitorContent.scrollTop = monitorContent.scrollHeight;
            
            // Keep only last 50 entries
            const entries = monitorContent.querySelectorAll('.log-entry');
            if (entries.length > 50) {
                entries[0].remove();
            }
                    }
                })
                .catch(error => {
                    console.error('Failed to get system status:', error);
                    // Add error entry
                    const logEntry = document.createElement('div');
                    logEntry.className = 'log-entry';
                    logEntry.innerHTML = `
                        <span class="log-timestamp">[${new Date().toLocaleTimeString()}]</span>
                        <span class="log-level-badge error">error</span>
                        <span>[system]</span>
                        <span>Failed to get system status</span>
                    `;
                    
                    monitorContent.appendChild(logEntry);
                    monitorContent.scrollTop = monitorContent.scrollHeight;
                });
        }

        function updateMonitorTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString();
            document.getElementById('monitorTime').textContent = timeString;
        }
        
        // User Management Functions
        function toggleUserForm() {
            const form = document.getElementById('userForm');
            const button = event.target.closest('button');
            
            if (form.classList.contains('show')) {
                // Hide form
                form.classList.remove('show');
                button.innerHTML = '<i class="fas fa-plus"></i> Add New User';
            } else {
                // Show form with loading state
                button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Loading...';
                button.disabled = true;
                
                // Simulate form load delay
                setTimeout(() => {
                    form.classList.add('show');
                    button.innerHTML = '<i class="fas fa-minus"></i> Cancel';
                    button.disabled = false;
                    
                    // Focus on first input
                    document.getElementById('username').focus();
                }, 500);
            }
        }
        
        // Load users
        async function loadUsers() {
            try {
                // Show loading state
                const tbody = document.getElementById('usersTableBody');
                tbody.innerHTML = `
                    <tr>
                        <td colspan="12" class="loading">
                            <div class="spinner"></div>
                            Loading users...
                        </td>
                    </tr>
                `;
                
                const response = await fetch('/api/admin/users', {
                    credentials: 'include'
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error);
                }
                
                tbody.innerHTML = '';
                
                if (data.users && data.users.length > 0) {
                    data.users.forEach(user => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${user.username}</td>
                            <td>${user.email}</td>
                            <td><span class="role-badge role-${user.role}">${user.role}</span></td>
                            <td><span class="status-badge status-${user.is_active ? 'active' : 'inactive'}">${user.is_active ? 'Active' : 'Inactive'}</span></td>
                            <td><span class="online-status" id="onlineStatus_${user.id}">Unknown</span></td>
                            <td><span class="hours-today" id="hoursToday_${user.id}">0h</span></td>
                            <td><span class="total-hours" id="totalHours_${user.id}">0h</span></td>
                            <td><span class="rating" id="rating_${user.id}">0.0</span></td>
                            <td><span class="working-hours" id="workingHours_${user.id}">0h</span></td>
                            <td>${new Date(user.created_at).toLocaleDateString()}</td>
                            <td>${user.last_login ? new Date(user.last_login).toLocaleDateString() : 'Never'}</td>
                            <td>
                                ${user.role === 'agent' ? `
                                    <button class="btn btn-info btn-sm" onclick="viewAgentDetails('${user.id}')" title="View Details">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                ` : ''}
                                <button class="btn btn-danger btn-sm" onclick="deleteUser('${user.id}')" title="Delete User">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        `;
                        tbody.appendChild(row);
                        
                        // Load additional agent data if it's an agent
                        if (user.role === 'agent') {
                            loadAgentData(user.id);
                        }
                    });
                    
                    // Update agent status overview
                    updateAgentStatusOverview(data.users);
                } else {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="12" style="text-align: center; padding: 40px; color: #666;">
                                <i class="fas fa-users" style="font-size: 2rem; margin-bottom: 15px; display: block; opacity: 0.3;"></i>
                                <p>No users found</p>
                                <small>Create your first user to get started</small>
                            </td>
                        </tr>
                    `;
                }
                
            } catch (error) {
                console.error('Failed to load users:', error);
                document.getElementById('usersTableBody').innerHTML = `
                    <tr>
                        <td colspan="12" style="text-align: center; padding: 40px; color: #dc3545;">
                            <i class="fas fa-exclamation-triangle" style="font-size: 2rem; margin-bottom: 15px; display: block;"></i>
                            <p>Failed to load users</p>
                            <small>Error: ${error.message}</small>
                            <br><br>
                            <button class="btn btn-primary" onclick="loadUsers()">
                                <i class="fas fa-sync"></i> Retry
                            </button>
                        </td>
                    </tr>
                `;
            }
        }
        
        // Add user form submission with enhanced agent creation
        document.getElementById('addUserForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Show loading state
            const submitButton = this.querySelector('button[type="submit"]');
            const originalText = submitButton.innerHTML;
            submitButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Creating...';
            submitButton.disabled = true;
            
            const formData = new FormData(this);
            const userData = {
                username: formData.get('username'),
                email: formData.get('email'),
                password: formData.get('password'),
                role: formData.get('role')
            };
            
            // Add agent-specific fields if creating an agent
            if (userData.role === 'agent') {
                userData.firstName = formData.get('firstName') || '';
                userData.lastName = formData.get('lastName') || '';
                userData.hourlyRate = parseFloat(formData.get('hourlyRate')) || 0.0;
                userData.skills = formData.get('skills') ? formData.get('skills').split(',').map(s => s.trim()) : [];
            }
            
            try {
                const response = await fetch('/api/admin/users', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    credentials: 'include',
                    body: JSON.stringify(userData)
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const result = await response.json();
                
                if (result.success) {
                    showNotification('User created successfully!', 'success');
                    this.reset();
                    toggleUserForm();
                    loadUsers();
                } else {
                    throw new Error(result.error || 'Failed to create user');
                }
            } catch (error) {
                console.error('Failed to create user:', error);
                showNotification('Failed to create user: ' + error.message, 'error');
            } finally {
                // Re-enable button
                submitButton.innerHTML = originalText;
                submitButton.disabled = false;
            }
        });
        
        // Delete user
        function deleteUser(userId) {
            if (confirm('Are you sure you want to delete this user?')) {
                // Show loading state
                const deleteButton = event.target.closest('button');
                const originalText = deleteButton.innerHTML;
                deleteButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
                deleteButton.disabled = true;
                
                // Implement user deletion
                setTimeout(() => {
                    // Re-enable button
                    deleteButton.innerHTML = originalText;
                    deleteButton.disabled = false;
                    
                    // Show success message
                    showNotification('User deletion functionality will be implemented here.', 'info');
                }, 1000);
            }
        }
        
        // Enhanced Agent Management Functions
        
        // Add event listener for role change
        document.getElementById('role').addEventListener('change', toggleAgentFields);
        
        // Show/hide agent fields based on role selection
        function toggleAgentFields() {
            const roleSelect = document.getElementById('role');
            const agentFields = document.getElementById('agentFields');
            const agentFields2 = document.getElementById('agentFields2');
            
            if (roleSelect.value === 'agent') {
                agentFields.style.display = 'block';
                agentFields2.style.display = 'block';
            } else {
                agentFields.style.display = 'none';
                agentFields2.style.display = 'none';
            }
        }
        
        // Load agent data for enhanced table display
        async function loadAgentData(agentId) {
            try {
                // Get real-time agent status
                const statusResponse = await fetch(`/api/agent/status/${agentId}`, {
                    credentials: 'include'
                });
                
                if (statusResponse.ok) {
                    const statusData = await statusResponse.json();
                    
                    // Update online status with real data
                    const onlineStatusElement = document.getElementById(`onlineStatus_${agentId}`);
                    if (onlineStatusElement) {
                        if (statusData.status === 'online') {
                            onlineStatusElement.textContent = 'Online';
                            onlineStatusElement.className = 'online-status online';
                        } else if (statusData.status === 'busy') {
                            onlineStatusElement.textContent = 'Busy';
                            onlineStatusElement.className = 'online-status busy';
                        } else {
                            onlineStatusElement.textContent = 'Offline';
                            onlineStatusElement.className = 'online-status offline';
                        }
                    }
                }
                
                // Get agent stats
                const response = await fetch(`/api/agent/stats/${agentId}`, {
                    credentials: 'include'
                });
                if (response.ok) {
                    const data = await response.json();
                    
                    // Update hours today
                    const hoursTodayElement = document.getElementById(`hoursToday_${agentId}`);
                    if (hoursTodayElement) {
                        hoursTodayElement.textContent = `${data.avg_response_time}h`;
                    }
                    
                    // Update total hours (this would come from a different endpoint)
                    const totalHoursElement = document.getElementById(`totalHours_${agentId}`);
                    if (totalHoursElement) {
                        totalHoursElement.textContent = `${data.total_escalations}h`;
                    }
                    
                    // Update rating
                    const ratingElement = document.getElementById(`rating_${agentId}`);
                    if (ratingElement) {
                        ratingElement.textContent = data.avg_satisfaction.toFixed(1);
                    }
                    
                    // Update working hours from user data
                    const workingHoursElement = document.getElementById(`workingHours_${agentId}`);
                    if (workingHoursElement) {
                        // Get working hours from user data
                        fetch(`/api/admin/users`, {
                            credentials: 'include'
                        }).then(response => response.json()).then(userData => {
                            const user = userData.users.find(u => u.id === agentId);
                            if (user && user.total_working_hours) {
                                workingHoursElement.textContent = `${user.total_working_hours.toFixed(1)}h`;
                            } else {
                                workingHoursElement.textContent = '0h';
                            }
                        }).catch(() => {
                            workingHoursElement.textContent = '0h';
                        });
                    }
                }
            } catch (error) {
                console.error('Failed to load agent data:', error);
            }
        }
        
        // Update agent status overview
        async function updateAgentStatusOverview(users) {
            const agents = users.filter(user => user.role === 'agent');
            const totalAgents = agents.length;
            
            // Get real-time status from agent sessions
            let onlineAgents = 0;
            let busyAgents = 0;
            let offlineAgents = 0;
            
            for (const agent of agents) {
                try {
                    const response = await fetch(`/api/agent/status/${agent.id}`, {
                        credentials: 'include'
                    });
                    if (response.ok) {
                        const statusData = await response.json();
                        if (statusData.status === 'online') {
                            onlineAgents++;
                        } else if (statusData.status === 'busy') {
                            busyAgents++;
                        } else {
                            offlineAgents++;
                        }
                    } else {
                        offlineAgents++;
                    }
                } catch (error) {
                    offlineAgents++;
                }
            }
            
            document.getElementById('totalAgents').textContent = totalAgents;
            document.getElementById('onlineAgents').textContent = onlineAgents;
            document.getElementById('busyAgents').textContent = busyAgents;
            document.getElementById('offlineAgents').textContent = offlineAgents;
        }
        
        // Load agent details for the detailed view
        async function loadAgentDetails() {
            const agentSelect = document.getElementById('agentSelect');
            const agentId = agentSelect.value;
            
            if (!agentId) {
                document.getElementById('agentDetailsContent').style.display = 'none';
                return;
            }
            
            try {
                // Show loading state
                document.getElementById('agentDetailsContent').style.display = 'block';
                document.getElementById('agentActivityList').innerHTML = `
                    <div class="loading-placeholder">
                        <i class="fas fa-spinner fa-spin"></i>
                        <span>Loading agent details...</span>
                    </div>
                `;
                
                // Load real-time agent data
                const response = await fetch(`/api/admin/agent/${agentId}`, {
                    credentials: 'include'
                });
                
                if (response.ok) {
                    const agentData = await response.json();
                    
                    // Update agent profile with real data
                    document.getElementById('agentName').textContent = agentData.username;
                    document.getElementById('agentEmail').textContent = agentData.email;
                    
                    // Update metrics with real-time data
                    document.getElementById('agentHoursToday').textContent = `${agentData.today_hours.toFixed(1)}h`;
                    document.getElementById('agentHoursWeek').textContent = `${agentData.week_hours.toFixed(1)}h`;
                    document.getElementById('agentHoursMonth').textContent = `${agentData.month_hours.toFixed(1)}h`;
                    document.getElementById('agentRating').textContent = agentData.resolution_rate.toFixed(1);
                    
                    // Update working hours chart with real data
                    const chartData = {
                        escalation_labels: ['Today', 'This Week', 'This Month', 'Total'],
                        escalation_activity: [
                            agentData.today_hours,
                            agentData.week_hours,
                            agentData.month_hours,
                            agentData.total_working_hours
                        ]
                    };
                    initializeAgentHoursChart(chartData);
                    
                    // Update recent activity with real data
                    const activityData = [
                        {
                            action: 'Escalations Handled',
                            count: agentData.total_escalations,
                            status: 'completed'
                        },
                        {
                            action: 'Resolution Rate',
                            count: `${agentData.resolution_rate.toFixed(1)}%`,
                            status: 'active'
                        }
                    ];
                    updateAgentActivity(activityData);
                    
                    // Load customer feedback
                    loadAgentFeedback(agentId);
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
            } catch (error) {
                console.error('Failed to load agent details:', error);
                document.getElementById('agentActivityList').innerHTML = `
                    <div class="error-state">
                        <i class="fas fa-exclamation-triangle"></i>
                        <h3>Failed to load agent details</h3>
                        <p>Error: ${error.message}</p>
                    </div>
                `;
            }
        }
        
        // Initialize agent hours chart
        function initializeAgentHoursChart(data) {
            const ctx = document.getElementById('agentHoursChart').getContext('2d');
            
            if (window.agentHoursChart) {
                window.agentHoursChart.destroy();
            }
            
            window.agentHoursChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.escalation_labels,
                    datasets: [{
                        label: 'Working Hours',
                        data: data.escalation_activity,
                        backgroundColor: 'rgba(40, 167, 69, 0.8)',
                        borderColor: '#28a745',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
        }
        
        // Update agent activity list
        function updateAgentActivity(escalations) {
            const container = document.getElementById('agentActivityList');
            
            if (!escalations || escalations.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-inbox"></i>
                        <h3>No Recent Activity</h3>
                        <p>This agent hasn't had any recent activity.</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = escalations.map(esc => `
                <div class="activity-item">
                    <div class="activity-header">
                        <span class="activity-type">Escalation</span>
                        <span class="activity-time">${new Date(esc.timestamp).toLocaleString()}</span>
                    </div>
                    <div class="activity-content">
                        <strong>Session:</strong> ${esc.session_id}<br>
                        <strong>Reason:</strong> ${esc.reason}<br>
                        <strong>Status:</strong> ${esc.status}
                        ${esc.satisfaction_score ? `<br><strong>Satisfaction:</strong> ${esc.satisfaction_score}/5` : ''}
                    </div>
                </div>
            `).join('');
        }
        
        // Load and display customer feedback for the selected agent
        async function loadAgentFeedback(agentId) {
            try {
                const response = await fetch(`/api/agent/feedback/${agentId}`, {
                    credentials: 'include'
                });
                if (response.ok) {
                    const data = await response.json();
                    updateFeedbackDisplay(data.feedback);
                } else {
                    throw new Error('Failed to load feedback');
                }
            } catch (error) {
                console.error('Error loading agent feedback:', error);
                document.getElementById('agentFeedbackList').innerHTML = `
                    <div class="error-state">
                        <i class="fas fa-exclamation-triangle"></i>
                        <h3>Failed to load feedback</h3>
                        <p>Error: ${error.message}</p>
                    </div>
                `;
            }
        }
        
        // Update feedback display with statistics and list
        function updateFeedbackDisplay(feedbackList) {
            if (!feedbackList || feedbackList.length === 0) {
                document.getElementById('agentFeedbackList').innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-comment-slash"></i>
                        <h3>No Customer Feedback</h3>
                        <p>This agent hasn't received any feedback yet.</p>
                    </div>
                `;
                
                // Reset stats
                document.getElementById('totalFeedback').textContent = '0';
                document.getElementById('avgRating').textContent = '0.0';
                document.getElementById('positiveFeedback').textContent = '0';
                return;
            }
            
            // Calculate statistics
            const totalFeedback = feedbackList.length;
            const totalRating = feedbackList.reduce((sum, fb) => sum + fb.rating, 0);
            const avgRating = totalRating / totalFeedback;
            const positiveFeedback = feedbackList.filter(fb => fb.rating >= 4).length;
            
            // Update stats
            document.getElementById('totalFeedback').textContent = totalFeedback;
            document.getElementById('avgRating').textContent = avgRating.toFixed(1);
            document.getElementById('positiveFeedback').textContent = positiveFeedback;
            
            // Display feedback list
            const container = document.getElementById('agentFeedbackList');
            container.innerHTML = feedbackList.map(fb => `
                <div class="feedback-item">
                    <div class="feedback-header">
                        <div class="feedback-rating">
                            ${generateStarRating(fb.rating)}
                        </div>
                        <div class="feedback-time">
                            ${new Date(fb.created_at).toLocaleString()}
                        </div>
                        <span class="feedback-type">${fb.feedback_type}</span>
                    </div>
                    ${fb.comment ? `<div class="feedback-comment">${fb.comment}</div>` : ''}
                    <div class="feedback-session">Session: ${fb.session_id}</div>
                </div>
            `).join('');
        }
        
        // Generate star rating display
        function generateStarRating(rating) {
            let stars = '';
            for (let i = 1; i <= 5; i++) {
                if (i <= rating) {
                    stars += '<span class="feedback-star">â˜…</span>';
                } else {
                    stars += '<span class="feedback-star empty">â˜†</span>';
                }
            }
            return stars;
        }
        
        // View agent details (switch to agent details tab)
        function viewAgentDetails(agentId) {
            // Populate agent select and switch to agent details tab
            const agentSelect = document.getElementById('agentSelect');
            agentSelect.value = agentId;
            showTab('agent-details');
            loadAgentDetails();
        }
        
        // View agent chats
        function viewAgentChats() {
            showNotification('Agent chat viewing functionality will be implemented here.', 'info');
        }
        
        // Export agent report
        function exportAgentReport() {
            showNotification('Agent report export functionality will be implemented here.', 'info');
        }
        
        // Populate agent select dropdown
        async function populateAgentSelect() {
            try {
                const response = await fetch('/api/admin/users', {
                    credentials: 'include'
                });
                if (response.ok) {
                    const data = await response.json();
                    const agentSelect = document.getElementById('agentSelect');
                    
                    if (agentSelect && data.users) {
                        // Clear existing options
                        agentSelect.innerHTML = '<option value="">Choose an agent...</option>';
                        
                        // Add agent options
                        data.users.forEach(user => {
                            if (user.role === 'agent') {
                                const option = document.createElement('option');
                                option.value = user.id;
                                option.textContent = `${user.username} (${user.email})`;
                                agentSelect.appendChild(option);
                            }
                        });
                    }
                }
            } catch (error) {
                console.error('Failed to populate agent select:', error);
            }
        }
        
        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            // Show loading state
            const mainContent = document.querySelector('.main-content');
            mainContent.style.opacity = '0.8';
            
            // Load initial data
            loadAnalyticsData();
            loadUsers();
            loadPerformanceData();
            populateAgentSelect(); // Add this line to populate agent selection
            
            // Remove loading state after initialization
            setTimeout(() => {
                mainContent.style.opacity = '1';
            }, 1500);
            
            // Refresh data every 30 seconds
            setInterval(() => {
                if (currentTab === 'analytics') {
                    loadAnalyticsData();
                }
            }, 30000);
        });
        
        // Handle window resize
        window.addEventListener('resize', function() {
            // Show loading state during resize
            const mainContent = document.querySelector('.main-content');
            mainContent.style.opacity = '0.9';
            
            if (window.innerWidth > 768) {
                document.getElementById('sidebar').classList.remove('show');
            }
            
            // Remove loading state after resize
            setTimeout(() => {
                mainContent.style.opacity = '1';
            }, 300);
        });
    </script>
</body>
</html>
